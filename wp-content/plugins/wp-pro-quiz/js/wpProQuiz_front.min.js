(function(d){d.wpProQuizFront=function(r,f){var b=d(r),e=this,p=0,l=0,u=0,j={},m=0,q=0,k=!1,v=!1,w=!1,s=!1,t=!1;e.methode={preStartQuiz:function(){j={};f.questionRandom&&e.methode.questionRandom();f.answerRandom?e.methode.answerRandom(".wpProQuiz_questionList"):e.methode.answerRandom(b.find(".wpProQuiz_sortable").parent().parent());e.methode.answerRandom(".wpProQuiz_sortStringList");m=p=0;f.questionOnSinglePage||(f.checkAnswer?b.find('input[name="check"]').show():b.find('input[name="next"]').show());
!v||!s?e.methode.startQuiz():t=!0;f.numberedAnswer&&e.methode.numberedAnswer()},startQuiz:function(){b.find(".wpProQuiz_text").hide();w?b.find(".wpProQuiz_lock").show():(u=new Date,f.timeLimit&&e.methode.setTimeLimit(),f.questionOnSinglePage&&b.find(".wpProQuiz_listItem").show(),b.find(".wpProQuiz_listItem").first().show(),b.find(".wpProQuiz_quiz").fadeIn(200),b.find(".wpProQuiz_sortable").parent().parent().sortable().disableSelection(),b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",
placeholder:"wpProQuiz_placehold"}).disableSelection())},scrollTo:function(a,c){var b=a.offset().top-100;c?(window.pageYOffset||document.body.scrollTop)>b&&d("html,body").animate({scrollTop:b},300):d("html,body").animate({scrollTop:b},300)},reStartQuiz:function(){b.find(".wpProQuiz_answerCorrect").removeClass("wpProQuiz_answerCorrect");b.find(".wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerIncorrect");b.find('.wpProQuiz_text, input[name="tip"]').show();b.find(".wpProQuiz_quiz, .wpProQuiz_results, .wpProQuiz_response, .wpProQuiz_correct, .wpProQuiz_incorrect").hide();
b.find(".wpProQuiz_time_limit, .wpProQuiz_time_limit_expired, .wpProQuiz_sort_correct_answer").hide();b.find(".wpProQuiz_quiz").children().first().children().hide();b.find(".wpProQuiz_sortable, .wpProQuiz_sortStringItem").removeAttr("style");b.find('input[name="check"]').hide();b.find('input[name="next"]').hide();b.find(".wpProQuiz_questionInput").removeAttr("disabled").removeAttr("checked");b.find('input.wpProQuiz_questionInput[type="text"]').removeAttr("value");b.find(".wpProQuiz_resultsList").children().hide();
b.find(".wpProQuiz_cloze input").removeAttr("disabled").removeAttr("value").css("background-color","");b.find(".wpProQuiz_cloze span").hide();b.find('input[name="checkSingle"]').show();f.questionOnSinglePage||b.find(".wpProQuiz_question_page").show();e.methode.resetMatrix();b.find(".wpProQuiz_listItem").data("isChecked",!1)},numberedAnswer:function(){b.find(".wpProQuiz_listItem").each(function(){var a=d(this),c=a.data("type"),b=1;("multiple"==c||"single"==c)&&a.find(".WpProQuiz_numberedAnswer").each(function(){d(this).text(b++ +
". ")})})},resetMatrix:function(){b.find(".wpProQuiz_question").each(function(){var a=d(this),c=a.find(".wpProQuiz_sortStringList");a.find(".wpProQuiz_sortStringItem").each(function(){c.append(d(this))})})},setTimeLimit:function(){var a=b.find(".wpProQuiz_time_limit"),c=a.find("span"),d=f.timeLimit;a.css({width:"100%",display:"block"});c.html(e.methode.parseTime(d));a.find(".progress").css("width","100%").animate({width:"0%"},1E3*f.timeLimit);l=setInterval(function(){c.html(e.methode.parseTime(d--));
0>d&&(clearInterval(l),l=0,a.find(".progress").clearQueue().stop(),b.find('input[name="check"]').click().parent().hide(),b.find(".wpProQuiz_time_limit_expired").show(),e.methode.showResult())},1E3)},parseTime:function(a){var c=parseInt(a%60),b=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<b?"":"0")+b)+":"+((9<c?"":"0")+c)},setQuizTime:function(){var a=((new Date).getTime()-u.getTime())/1E3;b.find(".wpProQuiz_quiz_time span").first().html(e.methode.parseTime(a))},setData:function(){var a=
0;b.find(".wpProQuiz_questionList").each(function(){var c=f.json[a],b=0;q+=c.points;d(this).parent().parent().data("type",c.answer_type).data("questionId",c.id).data("points",c.points).data("pointsPerAnswer",c.pointsPerAnswer).data("pointsAnswer",c.pointsAnswer);d(this).find(".wpProQuiz_questionInput").each(function(){switch(c.answer_type){case "single":case "multiple":0<=d.inArray(this.value,c.correct)?d(this).data("correct","1"):d(this).data("correct","0");break;case "free_answer":d(this).data("correct",
c.correct)}});b=0;d(this).find(".wpProQuiz_sortable").each(function(){d(this).data("correct",c.correct[b++])});b=0;d(this).parent().find(".wpProQuiz_sortStringList").children().each(function(){d(this).data("correct",c.correct[b++])});"matrix_sort_answer"==c.answer_type&&d(this).children().each(function(){d(this).data("correct",d(this).index())});a++})},checkAnswer:function(a){var c=d(a).parent(),b=!1,n=c.find(".wpProQuiz_questionInput"),h=c.data("type"),i=0;c.find('input[name="tip"]').hide();if(!c.data("isChecked")){if("multiple"==
h||"single"==h){var g=!0;n.each(function(){"1"==d(this).data("correct")?(e.methode.setAnswerMark(d(this).parent().parent(),!0),this.checked?(g&=1,i++):g&=0):this.checked&&(e.methode.setAnswerMark(d(this).parent().parent(),!1),g&=0)});b=g}else if("sort_answer"==h){g=!0;c.find(".wpProQuiz_sortable").each(function(){var a=d(this),b=a.parent().index();a.data("correct")==b?(e.methode.setAnswerMark(a.parent(),!0),g&=1,i++):(e.methode.setAnswerMark(a.parent(),!1),g=!1);a.css({"box-shadow":"0 0",cursor:"auto"})});
var k=c.find(".wpProQuiz_sortable").parent().parent(),b=k.children("li");k.sortable("destroy");b.sort(function(a,b){return d(a).children("div").data("correct")-d(b).children("div").data("correct")});d.each(b,function(a,b){k.append(b)});b=g}else if("free_answer"==h)h=d.trim(n.val()).toLowerCase(),0<=d.inArray(h,n.data("correct"))?(b=!0,i++,e.methode.setAnswerMark(n.parent().parent(),!0)):e.methode.setAnswerMark(n.parent().parent(),!1);else if("matrix_sort_answer"==h){var g=!0,l={};c.find(".wpProQuiz_questionList").children().each(function(){var a=
d(this).data("correct"),b=d(this).find(".wpProQuiz_maxtrixSortCriterion");b.children().first().data("correct")==a?(g&=1,i++,e.methode.setAnswerMark(b,!0)):(g=!1,e.methode.setAnswerMark(b,!1));l[a]=d(this)});c.find(".wpProQuiz_sortStringItem").each(function(){l[d(this).data("correct")].find(".wpProQuiz_maxtrixSortCriterion").append(this)}).css({"box-shadow":"0 0",cursor:"auto"});c.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy");b=g}else"cloze_answer"==h&&(g=!0,
c.find(".wpProQuiz_cloze").each(function(){var a=d(this).children(),b=a.first(),c=b.val().toLowerCase(),h=a.last().text().toLowerCase(),h=d.trim(h.substr(1,h.length-2)),h=e.methode.cleanupCurlyQuotes(h),c=e.methode.cleanupCurlyQuotes(d.trim(c));h==c?(g&=1,i++,f.disabledAnswerMark||b.css("background-color","#B0DAB0")):(g=!1,f.disabledAnswerMark||b.css("background-color","#FFBABA"),a.last().show());b.attr("disabled","disabled")}),b=g);d(a).hide();n.attr("disabled","disabled");void 0==j[c.data("questionId")]&&
(j[c.data("questionId")]={});j[c.data("questionId")].correct=Number(b);c.find(".wpProQuiz_response").show();c.data("pointsPerAnswer")&&(m+=c.data("pointsAnswer")*i,j[c.data("questionId")].correct_answer_count=i);c.find(".wpProQuiz_responsePoints").text(c.data("pointsAnswer")*i);b?(c.find(".wpProQuiz_correct").show(),p++,c.data("pointsPerAnswer")||(m+=c.data("points"),j[c.data("questionId")].correct_answer_count=1)):c.find(".wpProQuiz_incorrect").show();c.find('input[name="next"]').show();c.data("isChecked",
!0)}},setAnswerMark:function(a,b){f.disabledAnswerMark||(b?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},nextQuestion:function(a){var a=d(a).parent(),c=a.next();a.hide();c.length?(c.show(),f.backButton&&!f.checkAnswer&&c.find('input[name="back"]').show(),e.methode.scrollTo(c,!0)):(f.questionOnSinglePage&&b.find('.wpProQuiz_listItem, input[name="checkSingle"]').hide(),(!f.checkAnswer||f.questionOnSinglePage)&&b.find('input[name="check"]').click(),e.methode.showResult())},
backQuestion:function(a){var a=d(a).parent(),b=a.prev();a.hide();b.show();e.methode.scrollTo(b,!0)},showResult:function(){clearInterval(l);var a=b.find(".wpProQuiz_points span");b.find(".wpProQuiz_time_limit .progress").clearQueue().stop();b.find(".wpProQuiz_correct_answer").html(p);b.find(".wpProQuiz_results").show();b.find('.wpProQuiz_time_limit, input[name="checkSingle"]').hide();e.methode.setQuizTime();var c=Math.round(1E4*(m/q))/100;a.eq(0).text(m);a.eq(1).text(q);a.eq(2).text(c);a=e.methode.findResultIndex(c);
-1<a&&b.find(".wpProQuiz_resultsList").children().eq(a).show();e.methode.scrollTo(b.find(".wpProQuiz_results"),!0);e.methode.sendCompletedQuiz()},sendCompletedQuiz:function(){f.preview||(k&&(jQuery.support.cors=!0),d.post(f.url,{action:"wp_pro_quiz_completed_quiz",results:j,quizId:f.quizId}),k&&(jQuery.support.cors=!1))},findResultIndex:function(a){for(var b=f.resultsGrade,d=-1,e=999999,h=0;h<b.length;h++){var i=b[h];a>=i&&a-i<e&&(e=a-i,d=h)}return d},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,
"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');return a=a.replace(/\u201D/,'"')},reShowQuestion:function(){b.find('input[name="next"], input[name="check"], input[name="back"], input[name="checkSingle"]').hide();b.find(".wpProQuiz_quiz").children().first().children().show();b.find(".wpProQuiz_question_page").hide()},answerRandom:function(a){b.find(a).each(function(){var a=d(this).children(),a=a.sort(function(){return Math.round(Math.random())-0.5}).slice(0,a.length);d(a).appendTo(a[0].parentNode).show()})},
questionRandom:function(){var a=b.find(".wpProQuiz_quiz ol").children(),a=a.sort(function(){return Math.round(Math.random())-0.5}).slice(0,a.length);d(a).appendTo(a[0].parentNode);var c=1;d(a).each(function(){d(this).find(".wpProQuiz_question_page span").eq(0).html(c);d(this).find("h3 span").html(c++)})},showTip:function(a){$tip=d(a).siblings(".wpProQuiz_tipp");$par=d(a).parent();void 0==j[$par.data("questionId")]&&(j[$par.data("questionId")]={});j[$par.data("questionId")].tip=1;$tip.toggle("fast")},
setClozeStyle:function(){b.find(".wpProQuiz_cloze").each(function(){var a=d(this).children(),b=a.first(),a=a.last().clone();a.css("visibility","hidden");d("body").append(a);var e=a.width();a.remove();b.width(e+10)})},checkLock:function(){s=!0;k&&(jQuery.support.cors=!0);d.post(f.url,{action:"wp_pro_quiz_check_lock",quizId:f.quizId},function(a){w=a.is;s=!1;a.pre&&b.find('input[name="restartQuiz"]').hide();t&&(t=!1,e.methode.startQuiz())},"json");k&&(jQuery.support.cors=!1)}};e.init=function(){f.cors&&
(void 0!=jQuery.support&&void 0!=jQuery.support.cors&&!1==jQuery.support.cors)&&(k=!0);p=0;f.lock&&!f.preview&&(v=!0,e.methode.checkLock());void 0==f.resultsGrade&&(f.resultsGrade=[0]);b.find(".wpProQuiz_quiz, .wpProQuiz_results").hide();b.find(".wpProQuiz_quiz").children().first().children().hide();e.methode.setData();e.methode.setClozeStyle();b.find('input[name="startQuiz"]').click(function(a){a.preventDefault();e.methode.preStartQuiz()});b.find('input[name="check"]').click(function(a){a.preventDefault();
e.methode.checkAnswer(this)});b.find('input[name="next"]').click(function(a){a.preventDefault();e.methode.nextQuestion(this)});b.find('input[name="restartQuiz"]').click(function(a){a.preventDefault();e.methode.reStartQuiz()});b.find('input[name="reShowQuestion"]').click(function(a){a.preventDefault();e.methode.reShowQuestion(this)});b.find('input[name="back"]').click(function(){e.methode.backQuestion(this)});b.find('input[name="tip"]').click(function(){e.methode.showTip(this)});b.find('input[name="checkSingle"]').click(function(){b.find('input[name="next"]').last().click()});
d(document).mouseup(function(a){var c=b.find(".wpProQuiz_tipp"),d=b.find('input[name="tip"]');!c.is(a.target)&&(0==c.has(a.target).length&&!d.is(a.target))&&c.hide("fast")})};e.init()};d.fn.wpProQuizFront=function(r){return this.each(function(){void 0==d(this).data("wpProQuizFront")&&d(this).data("wpProQuizFront",new d.wpProQuizFront(this,r))})}})(jQuery);
