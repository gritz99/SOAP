jQuery(document).ready(function(a){a.fn.wpProQuiz_preview=function(){var c={openPreview:function(e){window.open(a(e).attr("href"),"wpProQuizPreview","width=900,height=900")}};a(".wpProQuiz_prview").click(function(a){c.openPreview(this);a.preventDefault()})};a.fn.wpProQuiz_quizOverall=function(){var c={changeExport:function(e){$input=a(e);$export=a(".wpProQuiz_exportList");$ul=$export.find("ul").first();$export.find("li").remove();a('input[name="exportItems"]').each(function(){$this=a(this);if(this.checked){var b=
$this.parent().parent().find(".wpProQuiz_quizName").text();a("<li>"+b+"</li>").appendTo($ul)}})},startExport:function(){$ele=a('input[name="exportItems"]:checked');if(1>$ele.length)return alert(wpProQuizLocalize.no_selected_quiz),!1;$hidden=a("#exportHidden");$hidden.html("");a('input[name="exportItems"]').each(function(){$this=a(this);this.checked&&a('<input type="hidden" value="'+this.value+'" name="exportIds[]">').appendTo($hidden)});return!0}};a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?
(a.preventDefault(),!1):!0});a(".wpProQuiz_import").click(function(c){c.preventDefault();a(".wpProQuiz_importList").toggle("fast");a(".wpProQuiz_exportList").hide();a(".wpProQuiz_exportCheck").hide()});a(".wpProQuiz_export").click(function(c){c.preventDefault();a(".wpProQuiz_exportList").toggle("fast");a(".wpProQuiz_exportCheck").toggle("fast");a(".wpProQuiz_importList").hide()});a('input[name="exportItems"]').change(function(){c.changeExport(this)});a('input[name="exportItemsAll"]').change(function(){var c=
a('input[name="exportItems"]');this.checked?c.attr("checked",!0):c.attr("checked",!1);c.change()});a("#exportStart").click(function(a){c.startExport()||a.preventDefault()})};a.fn.wpProQuiz_questionEdit=function(){var c={setup:function(){a('input[name="answerType"]').click(function(){a(".answer_felder").children().css("display","none");switch(this.value){case "single":c.displaySingle("radio");break;case "multiple":c.displaySingle("checkbox");break;case "free_answer":c.displayFreeAnswer();break;case "sort_answer":c.displaySortAnswer();
break;case "matrix_sort_answer":c.displayMatrixSortAnswer();break;case "cloze_answer":c.displayClozeAnswer()}});a(".addAnswer").click(function(){c.addAnswer(this)});a(".deleteAnswer").click(function(){c.deleteAnswer(this)});a("#saveQuestion").click(function(){return e()});a(".sort_answer ul, .classic_answer ul, .matrix_sort_answer ul").sortable({handle:".wpProQuiz_move",update:function(){c.setValueClassicAnswer()}});a("#wpProQuiz_correctSameText").change(function(){this.checked?a("#wpProQuiz_incorrectMassageBox").hide():
a("#wpProQuiz_incorrectMassageBox").show()});a("#wpProQuiz_tip").change(function(){this.checked?a("#wpProQuiz_tipBox").show():a("#wpProQuiz_tipBox").hide()});a('input[name="pointsPerAnswer"]').change(function(){this.checked?a("#wpProQuiz_showPointsBox").show():a("#wpProQuiz_showPointsBox").hide()});a(".wpProQuiz_demoBox a").mouseover(function(){a(this).next().show()}).mouseout(function(){a(this).next().hide()}).click(function(){return!1})},displaySingle:function(b){a(".classic_answer").find('input[name="answerJson[classic_answer][correct][]"]').each(function(){a("<input type="+
b+" />").attr({name:this.name,value:this.value,checked:this.checked}).insertBefore(this)}).remove();a(".classic_answer").css("display","block")},displayFreeAnswer:function(){a(".free_answer").css("display","block")},displaySortAnswer:function(){a(".sort_answer").css("display","block")},displayMatrixSortAnswer:function(){a(".matrix_sort_answer").show()},displayClozeAnswer:function(){a(".cloze_answer").show()},addAnswer:function(b){a(b).siblings("ul").children().first().clone().css("display","block").appendTo(a(b).siblings("ul"));
c.setValueClassicAnswer();a(".deleteAnswer").click(function(){c.deleteAnswer(this)})},deleteAnswer:function(b){a(b).parent("li").remove();c.setValueClassicAnswer()},setValueClassicAnswer:function(){a(".classic_answer ul, .matrix_sort_answer ul, .sort_answer ul").children().each(function(){var b=a(this).index();a(this).find('input[name="answerJson[classic_answer][correct][]"], input[name="answerJson[classic_answer][html][]"], input[name="answerJson[answer_matrix_sort][answer_html][]"], input[name="answerJson[answer_matrix_sort][sort_string_html][]"], input[name="answerJson[answer_sort][html][]"]').val(b)})}},
e=function(){var c="",d=a('input[name="answerType"]:checked'),e=a('input[name="points"]'),c=void 0!=tinymce.editors.question&&!tinymce.editors.question.isHidden()?tinymce.editors.question.getContent():a('textarea[name="question"]').val();if(isNaN(e.val())||1>e.val())return alert(wpProQuizLocalize.no_nummber_points),e.focus(),!1;if(b(c))return alert(wpProQuizLocalize.no_question_msg),!1;if("single"==d.val()||"multiple"==d.val()){var f=!0;if(1>a('input[name="answerJson[classic_answer][correct][]"]:checked').each(function(){f=
""!=a.trim(a(this).parent().siblings("textarea").val())?f&1:!1}).size())return alert(wpProQuizLocalize.no_correct_msg),!1;if(!f)return alert(wpProQuizLocalize.no_answer_msg),!1}else if("sort_answer"==d.val()){if(f=!1,a('textarea[name="answerJson[answer_sort][answer][]"]').each(function(){f=b(a(this).val())?f|0:!0}),!f)return alert(wpProQuizLocalize.no_answer_msg),!1}else if("matrix_sort_answer"==d.val()){if(f=!1,a('textarea[name="answerJson[answer_matrix_sort][answer][]"]').each(function(){if(b(a(this).val()))f|=
0;else{var c=a(this).parent().parent().find('textarea[name="answerJson[answer_matrix_sort][sort_string][]"]');f=b(c.val())?f|0:!0}}),!f)return alert(wpProQuizLocalize.no_answer_msg),!1}else if("cloze_answer"==d.val()){if(c="",c=void 0!=tinymce.editors.cloze&&!tinymce.editors.cloze.isHidden()?tinymce.editors.cloze.getContent():a('textarea[name="answerJson[answer_cloze][text]"]').val(),b(c))return alert(wpProQuizLocalize.no_answer_msg),!1}else if("free_answer"==d.val()&&(c=a('textarea[name="answerJson[free_answer][correct]"]').val(),
b(c)))return alert(wpProQuizLocalize.no_answer_msg),!1;return!0},b=function(b){b=a.trim(b);return!b||0===b.length};c.setup();1>a('input[name="answerType"][checked="checked"]').size()&&a('input[name="answerType"][value="single"]').attr({checked:"checked"});a('input[name="answerType"]:checked').click();a("#wpProQuiz_correctSameText").change();a("#wpProQuiz_tip").change();a('input[name="pointsPerAnswer"]').change()};a.fn.wpProQuiz_questionOverall=function(){var c={saveSort:function(){var e={action:"wp_pro_quiz_update_sort",
sort:c.parseSortArray()},b=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=save_sort";a.post(b,e,function(){a("#sortMsg").show(400).delay(1E3).hide(400)})},parseSortArray:function(){var c=[];a("tbody tr").each(function(){c.push(this.id.replace("wpProQuiz_questionId_",""))});return c},sortUpdate:function(){a(".wpProQuiz_questionOverall tbody").children().each(function(){$t=a(this).children().first().text(a(this).index()+1)})},loadQuestionCopy:function(){var c=
a("#questionCopySelect"),b=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_question";c.hide();c.empty();a("#loadDataImg").show();a.post(b,{action:"wp_pro_quiz_load_question",excludeId:1},function(b){a.each(b,function(b,g){var f=a(document.createElement("optgroup"));f.attr("label",g.name);a.each(g.question,function(b,c){a(document.createElement("option")).val(c.id).text(c.name).appendTo(f)});c.append(f)});a("#loadDataImg").hide();c.show()},"json")}};
a(".wp-list-table tbody").sortable({handle:".wpProQuiz_move",update:c.sortUpdate});a(".wpProQuiz_delete").click(function(a){return!confirm(wpProQuizLocalize.delete_msg)?(a.preventDefault(),!1):!0});a("#wpProQuiz_saveSort").click(function(a){a.preventDefault();c.saveSort()});a("#wpProQuiz_questionCopy").click(function(e){var b=a(".wpProQuiz_questionCopy");b.is(":visible")?b.hide():(b.show(),c.loadQuestionCopy());e.preventDefault()})};a.fn.wpProQuiz_quizEdit=function(){var c={addResult:function(){a("#resultList").children().each(function(){if("none"==
a(this).css("display")){var b=a(this),c=b.find('textarea[name="resultTextGrade[text][]"]'),d=c.attr("id"),e=!0;b.find('input[name="resultTextGrade[prozent][]"]').val("0");b.find('input[name="resultTextGrade[activ][]"]').val("1").keyup();void 0!=tinymce.editors[d]&&!tinymce.editors[d].isHidden()&&(e=!1);void 0!=switchEditors&&!e&&(switchEditors.go(d,"toggle"),switchEditors.go(d,"toggle"));void 0!=tinymce.editors[d]?tinymce.editors[d].setContent(""):c.val("");void 0!=tinymce.editors[d]&&!e&&tinyMCE.execCommand("mceRemoveControl",
!1,d);b.parent().children(":visible").last().after(b);void 0!=tinymce.editors[d]&&!e&&tinyMCE.execCommand("mceAddControl",!1,d);a(this).show();void 0!=switchEditors&&!e&&switchEditors.go(d,"toggle");return!1}})},deleteResult:function(b){a(b).parent().parent().hide();a(b).siblings('input[name="resultTextGrade[activ][]"]').val("0")},changeResult:function(b){b=a(b);if(c.validResultInput(b.val()))return b.siblings(".resultProzent").text(b.val()),b.removeAttr("style"),!0;b.css("background-color","#FF9696");
return!1},validResultInput:function(a){if(e(a))return!1;a=a.replace(/\,/,".");return!isNaN(a)&&100>=Number(a)&&0<=Number(a)?null!=a.match(/\./)?3>a.split(".")[1].length:!0:!1},validInput:function(){if(e(a("#wpProQuiz_title").val()))return alert(wpProQuizLocalize.no_title_msg),!1;var b="",b=void 0!=tinymce.editors.text&&!tinymce.editors.text.isHidden()?tinymce.editors.text.getContent():a('textarea[name="text"]').val();if(e(b))return alert(wpProQuizLocalize.no_quiz_start_msg),!1;if(a("#wpProQuiz_resultGradeEnabled:checked").length){var g=
!0;a("#resultList").children().each(function(){if(a(this).is(":visible")&&!c.validResultInput(a(this).find('input[name="resultTextGrade[prozent][]"]').val()))return g=!1});if(!g)return alert(wpProQuizLocalize.fail_grade_result),!1}return!0},resetLock:function(){var b=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php"),b=b.replace("action=edit","action=reset_lock");a.post(b,{action:"wp_pro_quiz_reset_lock"},function(){a("#resetLockMsg").show("fast").delay(2E3).hide("fast")})}},
e=function(b){b=a.trim(b);return!b||0===b.length};a("#statistics_on").change(function(){this.checked?a("#statistics_ip_lock_tr").show():a("#statistics_ip_lock_tr").hide()});a(".addResult").click(function(){c.addResult()});a(".deleteResult").click(function(){c.deleteResult(this)});a('input[name="resultTextGrade[prozent][]"]').keyup(function(){c.changeResult(this)}).keydown(function(a){13==a.which&&a.preventDefault()});a("#wpProQuiz_resultGradeEnabled").change(function(){this.checked?(a("#resultGrade").show(),
a("#resultNormal").hide()):(a("#resultGrade").hide(),a("#resultNormal").show())});a("#wpProQuiz_save").click(function(a){c.validInput()||a.preventDefault()});a('input[name="quizRunOnce"]').change(function(){this.checked?(a("#wpProQuiz_quiz_run_once_type").show(),a('input[name="quizRunOnceType"]:checked').change()):a("#wpProQuiz_quiz_run_once_type").hide()});a('input[name="quizRunOnceType"]').change(function(){this.checked&&("1"==this.value||"3"==this.value)?a("#wpProQuiz_quiz_run_once_cookie").show():
a("#wpProQuiz_quiz_run_once_cookie").hide()});a('input[name="resetQuizLock"]').click(function(){c.resetLock();return!1});a(".wpProQuiz_demoBox a").mouseover(function(){a(this).next().show()}).mouseout(function(){a(this).next().hide()}).click(function(){return!1});a('input[name="showMaxQuestion"]').change(function(){this.checked?(a('input[name="statisticsOn"]').removeAttr("checked").attr("disabled","disabled").change(),a("#wpProQuiz_showMaxBox").show()):(a('input[name="statisticsOn"]').removeAttr("disabled"),
a("#wpProQuiz_showMaxBox").hide())});a("#statistics_on").change();a("#wpProQuiz_resultGradeEnabled").change();a('input[name="quizRunOnce"]').change();a('input[name="quizRunOnceType"]:checked').change();a('input[name="showMaxQuestion"]').change()};a.fn.wpProQuiz_statistics=function(){var c="wpProQuiz_typeAnonymeUser",e=!0,b={loadStatistics:function(c){var d=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",c={action:"wp_pro_quiz_load_statistics",
userId:c};a("#wpProQuiz_loadData").show();a("#wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a.post(d,c,b.setStatistics,"json")},setStatistics:function(b){var d=a(".wpProQuiz_statistics_table"),e=d.find("tbody"),f=0,h=0,i=0;if("wpProQuiz_typeOverview"!=c){var j=function(a,b,c){a.find(".wpProQuiz_cCorrect").text(b.cCorrect+" ("+b.pCorrect+"%)");a.find(".wpProQuiz_cIncorrect").text(b.cIncorrect+" ("+b.pIncorrect+"%)");a.find(".wpProQuiz_cTip").text(b.cTip);a.find(".wpProQuiz_cCorrectAnswerPoints").text(b.cCorrectAnswerPoints*
a.find(".wpProQuiz_pointsAnswer").text());!0==c?(0<h?d.find(".wpProQuiz_cResult").text(Math.round(1E4*(f/h))/100+"%"):d.find(".wpProQuiz_cResult").text("0%"),a.find(".wpProQuiz_cCorrectAnswerPoints").text(i)):(f+=b.cCorrectAnswerPoints*a.find(".wpProQuiz_pointsAnswer").text(),h+=(b.cCorrect+b.cIncorrect)*a.find(".wpProQuiz_points").text(),i+=b.cCorrectAnswerPoints*a.find(".wpProQuiz_pointsAnswer").text())};j(d,b.clear,!1);a.each(b.items,function(a,b){j(e.find("#wpProQuiz_tr_"+b.id),b,!1)});j(d.find("tfoot"),
b.global,!0);a("#wpProQuiz_loadData").hide();a("#wpProQuiz_statistics_content, .wpProQuiz_statistics_table").show()}},loadOverview:function(){a(".wpProQuiz_statistics_table, #wpProQuiz_statistics_content, #wpProQuiz_statistics_overview").hide();a("#wpProQuiz_loadData").show();var g=(window.location.pathname+window.location.search).replace("admin.php","admin-ajax.php")+"&action=load_statistics",d={action:"wp_pro_quiz_load_statistics",overview:!0,pageLimit:a("#wpProQuiz_pageLimit").val(),onlyCompleted:Number(a("#wpProQuiz_onlyCompleted").is(":checked")),
page:a("#wpProQuiz_currentPage").val(),generatePageNav:Number(e)};a.post(g,d,function(d){a("#wpProQuiz_statistics_overview_data").empty();if("wpProQuiz_typeOverview"==c){var f=a('<tr><th><a href="#">---</a></th><th class="wpProQuiz_points">---</th><th class="wpProQuiz_cCorrect" style="color: green;">---</th><th class="wpProQuiz_cIncorrect" style="color: red;">---</th><th class="wpProQuiz_cTip">---</th><th class="wpProQuiz_cResult" style="font-weight: bold;">---</th></tr>');a.each(d.items,function(b,
c){var d=f.clone();d.find("a").text(c.userName).data("userId",c.userId).click(function(){a("#userSelect").val(a(this).data("userId"));a("#wpProQuiz_typeRegisteredUser").click();return!1});c.completed?(d.find(".wpProQuiz_points").text(c.cPoints),d.find(".wpProQuiz_cCorrect").text(c.cCorrect+" ("+c.pCorrect+"%)"),d.find(".wpProQuiz_cIncorrect").text(c.cIncorrect+" ("+c.pIncorrect+"%)"),d.find(".wpProQuiz_cTip").text(c.cTip),d.find(".wpProQuiz_cResult").text(Math.round(1E4*(c.cPoints/c.totalPoints))/
100+"%")):d.find("th").removeAttr("style");a("#wpProQuiz_statistics_overview_data").append(d)});void 0!=d.page&&(b.setPageNav(d.page),e=!1);a("#wpProQuiz_loadData").hide();a("#wpProQuiz_statistics_overview").show()}},"json")},changeTab:function(e){c=e;"wpProQuiz_typeRegisteredUser"==e?b.loadStatistics(a("#userSelect").val()):"wpProQuiz_typeAnonymeUser"==e?b.loadStatistics(0):b.loadOverview()},resetStatistic:function(e){var d="wpProQuiz_typeRegisteredUser"==c?a("#userSelect").val():0,k=(window.location.pathname+
window.location.search).replace("admin.php","admin-ajax.php")+"&action=reset";a.post(k,{action:"wp_pro_quiz_statistics",userId:d,complete:e},function(){b.changeTab(c)})},setPageNav:function(b){b=Math.ceil(b/a("#wpProQuiz_pageLimit").val());a("#wpProQuiz_currentPage").empty();for(var c=1;c<=b;c++)a(document.createElement("option")).val(c).text(c).appendTo(a("#wpProQuiz_currentPage"));a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1<a("#wpProQuiz_currentPage option").length&&a("#wpProQuiz_pageRight").show()}};
a(".wpProQuiz_tab").click(function(){var c=a(this);if(c.hasClass("button-primary"))return!1;"wpProQuiz_typeRegisteredUser"==c.attr("id")?a("#wpProQuiz_userBox").show():a("#wpProQuiz_userBox").hide();a(".wpProQuiz_tab").removeClass("button-primary").addClass("button-secondary");c.removeClass("button-secondary").addClass("button-primary");b.changeTab(c.attr("id"));return!1});a("#userSelect").change(function(){b.changeTab("wpProQuiz_typeRegisteredUser")});a(".wpProQuiz_update").click(function(){b.changeTab(c);
return!1});a("#wpProQuiz_reset").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&b.resetStatistic(!1);return!1});a(".wpProQuiz_resetComplete").click(function(){confirm(wpProQuizLocalize.reset_statistics_msg)&&b.resetStatistic(!0);return!1});a("#wpProQuiz_pageLimit, #wpProQuiz_onlyCompleted").change(function(){a("#wpProQuiz_currentPage").val(0);e=!0;b.changeTab(c);return!1});a("#wpProQuiz_currentPage").change(function(){a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").hide();1!=a("#wpProQuiz_currentPage option").length&&
(a("#wpProQuiz_currentPage option:first-child:selected").length?a("#wpProQuiz_pageRight").show():a("#wpProQuiz_currentPage option:last-child:selected").length?a("#wpProQuiz_pageLeft").show():a("#wpProQuiz_pageLeft, #wpProQuiz_pageRight").show());b.changeTab(c)});a("#wpProQuiz_pageRight").click(function(){a("#wpProQuiz_currentPage option:selected").next().attr("selected","selected");a("#wpProQuiz_currentPage").change();return!1});a("#wpProQuiz_pageLeft").click(function(){a("#wpProQuiz_currentPage option:selected").prev().attr("selected",
"selected");a("#wpProQuiz_currentPage").change();return!1});b.changeTab("wpProQuiz_typeAnonymeUser")};a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_preview();a(".wpProQuiz_quizOverall").length&&a(".wpProQuiz_quizOverall").wpProQuiz_quizOverall();a(".wpProQuiz_quizEdit").length&&a(".wpProQuiz_quizEdit").wpProQuiz_quizEdit();a(".wpProQuiz_questionEdit").length&&a(".wpProQuiz_questionEdit").wpProQuiz_questionEdit();a(".wpProQuiz_questionOverall").length&&a(".wpProQuiz_questionOverall").wpProQuiz_questionOverall();
a(".wpProQuiz_statistics").length&&a(".wpProQuiz_statistics").wpProQuiz_statistics()});
